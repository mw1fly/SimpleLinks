<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/style.css">

  <title>Rich's Internal Links</title>
  <link rel="icon" type="image/x-icon" href="/images/link.png">

</head>
<body>

  <div class="topnav">
	<table style="width:100%">
	  <tr>
		<td> 		  
			<div class="search-container">
			<img src="images/searxng.png" alt="Rich's SearXNG">   
			<form method="post" action="http://192.168.50.65:8080/">
			<!-- search      --> <input type="text" name="q">
			<!-- categories  --> <input type="hidden" name="categories" value="general,social media">
			<!-- language    --> <input type="hidden" name="lang" value="all">
			<!-- locale      --> <input type="hidden" name="locale" value="en">
			<!-- date filter --> <input type="hidden" name="time_range" value="month">
			<input type="submit" />
			</form>
		  </div> </td>
		<td> <h1><center>Internal Links</center></h1> </td>
		<td> 	  
		  <button class="button button2" onclick="myFunction()">Toggle light mode</button>
		</td>
	  </tr>
	</table>	  
</div>
<br>
<div class="richnav">
  <table id="linkTableTop"></table>
</div>

  <table id="linkTable"></table>


<hr>

<script>
  async function loadLinksFromAPI() {
    try {
      const response = await fetch("/links");
      const links = await response.json();
      const table = document.getElementById('linkTable');
      const cellsPerRow = 4;

      for (let i = 0; i < links.length; i += cellsPerRow) {
        const row = document.createElement('tr');

        for (let j = 0; j < cellsPerRow; j++) {
          const lineIndex = i + j;
          if (lineIndex >= links.length) break;

          const { url, type, comment, image } = links[lineIndex];

          const cell = document.createElement('td');
          cell.innerHTML = `
            <a href="${url}">
              <img src="${image}" alt="${type}">
            </a>
            <a class="two" href="${url}">${comment}</a>
          `;
          row.appendChild(cell);
        }

        table.appendChild(row);
      }
    } catch (error) {
      console.error("Failed to load links:", error);
    }
  }

  loadLinksFromAPI();
</script>

<script>
<script>
  document.getElementById("addForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const url = document.getElementById("url").value;
    const type = document.getElementById("type").value;
    const comment = document.getElementById("comment").value;
    const fileInput = document.getElementById("imageFile");

    let imagePath = "";

    // If a file was selected, upload it
    if (fileInput.files.length > 0) {
      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      const uploadResp = await fetch("/upload", {
        method: "POST",
        body: formData
      });

      if (uploadResp.ok) {
        const result = await uploadResp.json();
        imagePath = result.path; // e.g. images/test.png
      } else {
        alert("Image upload failed");
        return;
      }
    }

    // Now add link
    const response = await fetch("/links", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ url, type, comment, image: imagePath })
    });

    if (response.ok) {
      alert("Link added!");
      location.reload();
    } else {
      alert("Failed to add link");
    }
  });

  // Handle Delete Link
  document.getElementById("deleteForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const index = document.getElementById("deleteIndex").value;

    const response = await fetch(`/links/${index}`, { method: "DELETE" });

    if (response.ok) {
      alert("Link deleted!");
      location.reload();
    } else {
      alert("Failed to delete link");
    }
  });
</script>


</body>
</html>

